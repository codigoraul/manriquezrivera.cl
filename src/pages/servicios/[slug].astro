---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageHero from "../../components/PageHero.astro";
import Footer from "../../components/Footer.astro";
import { getServices, getServiceBySlug, getFeaturedImage } from "../../lib/wordpress";

export const prerender = true;

export async function getStaticPaths() {
  const services = await getServices();
  return services.map((service) => ({
    params: { slug: service.slug }
  }));
}

const { slug } = Astro.params;
const service = await getServiceBySlug(slug ?? "");

if (!service) {
  return Astro.redirect(`${Astro.base}/404`);
}

// Función para obtener título de forma segura
function getTitle(service: any): string {
  return service.title?.rendered || service.title || 'Servicio';
}

// Función para obtener contenido de forma segura
function getContent(service: any): string {
  return service.content?.rendered || '<p>Contenido no disponible</p>';
}

const title = getTitle(service);
const content = getContent(service);
---

<BaseLayout title={`${title} · Manríquez Rivera`}>
  <PageHero 
    title={title}
    breadcrumbs={[
      { label: "Inicio", href: "/" },
      { label: "Servicios", href: "/#servicios" },
      { label: title }
    ]}
    backgroundImage="/images/bg-title.jpg"
  />

  <!-- Contenido Principal -->
  <section class="py-20 px-6">
    <div class="max-w-container mx-auto">
      
      <!-- Diseño de dos columnas: Imagen + Contenido -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start mb-16">
        
        <!-- Columna Izquierda: Imagen Destacada -->
        <div class="relative">
          <div class="sticky top-8">
            <div class="relative rounded-2xl overflow-hidden shadow-2xl">
              <img 
                src={getFeaturedImage(service)}
                alt={title}
                class="w-full h-auto object-cover"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-primary/20 to-transparent"></div>
            </div>
          </div>
        </div>

        <!-- Columna Derecha: Contenido del Servicio -->
        <div>
          <div 
            class="prose prose-lg max-w-none
                   prose-headings:text-primary prose-headings:font-bold
                   prose-h2:text-3xl prose-h2:mb-6 prose-h2:mt-8
                   prose-h3:text-2xl prose-h3:mb-4 prose-h3:mt-6
                   prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-6
                   prose-strong:text-primary prose-strong:font-semibold
                   prose-ul:my-6 prose-ul:list-disc prose-ul:pl-6
                   prose-li:text-gray-700 prose-li:mb-2"
            set:html={content}
          />
        </div>
      </div>

      <!-- Call to Action -->
      <div class="text-center bg-primary text-white py-16 px-8 rounded-2xl mt-16">
        <h2 class="text-3xl md:text-4xl font-bold mb-6 text-white">
          ¿Necesita asesoría en {title}?
        </h2>
        <p class="text-lg text-white/90 mb-8 max-w-2xl mx-auto">
          Nuestro equipo de expertos está listo para ayudarle a resolver sus desafíos legales 
          y proteger los intereses de su empresa.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="#contacto" class="px-8 py-4 bg-secondary text-primary font-semibold rounded-lg hover:bg-secondary-dark transition-all duration-300 hover:scale-105 shadow-lg">
            Solicitar Consulta
          </a>
          <a href="https://wa.me/56912345678" target="_blank" rel="noreferrer" class="px-8 py-4 bg-white/10 text-white font-semibold rounded-lg hover:bg-white/20 transition-all duration-300 backdrop-blur-sm border border-white/30 inline-flex items-center justify-center gap-2">
            <svg aria-hidden="true" viewBox="0 0 32 32" class="w-5 h-5" fill="currentColor">
              <path d="M19.11 17.64c-.27-.14-1.59-.78-1.84-.87-.25-.09-.43-.14-.61.14-.18.27-.7.87-.86 1.05-.16.18-.32.2-.59.07-.27-.14-1.15-.42-2.19-1.35-.81-.72-1.36-1.61-1.52-1.88-.16-.27-.02-.42.12-.56.12-.12.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.48-.07-.14-.61-1.48-.84-2.02-.22-.54-.45-.46-.61-.47h-.52c-.18 0-.48.07-.73.34-.25.27-.95.93-.95 2.26 0 1.33.98 2.61 1.11 2.79.14.18 1.93 2.95 4.68 4.13.65.28 1.16.45 1.56.57.66.21 1.26.18 1.74.11.53-.08 1.59-.65 1.82-1.27.23-.62.23-1.15.16-1.27-.07-.12-.25-.2-.52-.34ZM16.02 27.5h-.01c-1.96 0-3.88-.53-5.55-1.54l-.4-.24-4.15 1.09 1.11-4.04-.26-.41a11.46 11.46 0 0 1-1.75-6.06C5.01 9.99 10.7 4.5 16.03 4.5c2.82 0 5.48 1.1 7.47 3.1a10.46 10.46 0 0 1 3.09 7.44c0 5.78-4.7 12.46-10.57 12.46Zm8.12-21.55A11.89 11.89 0 0 0 16.03 2.5C9.6 2.5 3.99 8.25 3.99 15.3c0 2.3.67 4.55 1.94 6.49L3.5 30l8.44-2.21a13.4 13.4 0 0 0 4.08.65h.01c6.43 0 12.04-5.75 12.04-12.8 0-3.2-1.24-6.2-3.93-9.69Z"/>
            </svg>
            WhatsApp
          </a>
        </div>
      </div>

    </div>
  </section>

  <Footer />
</BaseLayout>
