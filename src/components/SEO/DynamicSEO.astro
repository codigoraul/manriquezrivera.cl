---
import type { Post } from '../../lib/wordpress';

interface Props {
  post: Post;
  defaultImage?: string;
}

const { post, defaultImage = '/images/og-default.jpg' } = Astro.props as Props;
const rawBase = import.meta.env.BASE_URL ?? '/';
const basePath = rawBase === '/' ? '' : rawBase.replace(/\/$/, '');
const withBase = (path = '') => {
  if (!path) return basePath || '/';
  return path.startsWith('/') ? `${basePath}${path}` : `${basePath}/${path}`;
};

// Parse yoast_head_json if it's a string
let yoastHead = post.yoast_head_json;
if (typeof yoastHead === 'string') {
  try {
    yoastHead = JSON.parse(yoastHead);
  } catch (e) {
    console.error('Error parsing yoast_head_json', e);
    yoastHead = {};
  }
}

const yoastTitle = yoastHead?.title || post?.title?.rendered || 'Post';
const yoastDescription = yoastHead?.description || (post?.title?.rendered ? post.title.rendered : 'Post de Manr√≠quez Rivera');
const yoastKeywords = yoastHead?.keywords || '';
const yoastImage = yoastHead?.og_image?.[0]?.url || defaultImage;
---

<!-- Meta Tags Basic SEO -->
<title>{yoastTitle}</title>
<meta name="description" content={yoastDescription} />
<meta name="keywords" content={yoastKeywords} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article" />
<meta property="og:url" content={new URL(Astro.url.pathname, Astro.site).toString()} />
<meta property="og:title" content={yoastTitle} />
<meta property="og:description" content={yoastDescription} />
<meta property="og:image" content={withBase(yoastImage)} />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={new URL(Astro.url.pathname, Astro.site).toString()} />
<meta property="twitter:title" content={yoastTitle} />
<meta property="twitter:description" content={yoastDescription} />
<meta property="twitter:image" content={withBase(yoastImage)} />
